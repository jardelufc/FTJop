#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int CRC[32], Inic[32],D[32],C[32];


int hexatobin(char h){
    
//    char h;
    int bin;
    
    switch(h){
         
         case '0' : bin = 0;
              break;
              
         case '1' : bin = 1;
              break;    

         case '2' : bin = 10;
              break;
              
         case '3' : bin = 11;
              break;
              
         case '4' : bin = 100;
              break;
              
         case '5' : bin = 101;
              break;
              
         case '6' : bin = 110;
              break;
              
         case '7' : bin = 111;
              break;
              
         case '8' : bin = 1000;
              break;
              
         case '9' : bin = 1001;
              break;
              
         case 'A': bin = 1010;
              break;
         case 'a': bin = 1010;
              break;
              
         case 'B' : bin = 1011;
              break;
              
         case 'b': bin = 1011;
              break;
              
         case 'C': bin = 1100;
              break;
          
         case 'c': bin = 1100;
              break;
                  
         case 'D': bin = 1101;
              break;
              
         case 'd': bin = 1101;
              break;
              
         case 'E': bin = 1110;
              break;
              
         case 'e': bin = 1110;
              break;
              
         case 'F': bin = 1111;
              break;

         case 'f': bin = 1111;
              break;
    }
                       
return bin;
}


void CalcCRC(){

     int i=0, hexa[8];
     char fin_hex[9];


//////////////////////////////////////////////////////////////////////////////
     CRC[0]   =  D[31] xor D[30] ^ D[29] ^ D[28] ^ D[26] ^ D[25] ^ 
                 D[24] ^ D[16] ^ D[12] ^ D[10] ^ D[9]  ^ D[6]  ^ 
                 D[0]  ^ C[0]  ^ C[6]  ^ C[9]  ^ C[10] ^ C[12] ^ 
                 C[16] ^ C[24] ^ C[25] ^ C[26] ^ C[28] ^ C[29] ^ 
                 C[30] ^ C[31];
  
    CRC[1]    =  D[28] ^ D[27] ^ D[24] ^ D[17] ^ D[16] ^ D[13] ^ 
                 D[12] ^ D[11] ^ D[9] ^ D[7] ^ D[6] ^ D[1] ^ 
                 D[0] ^ C[0] ^ C[1] ^ C[6] ^ C[7] ^ C[9] ^ 
                 C[11] ^ C[12] ^ C[13] ^ C[16] ^ C[17] ^ C[24] ^ 
                 C[27] ^ C[28];
   
    CRC[2]    =  D[31] ^ D[30] ^ D[26] ^ D[24] ^ D[18] ^ D[17] ^ 
                 D[16] ^ D[14] ^ D[13] ^ D[9] ^ D[8] ^ D[7] ^ 
                 D[6] ^ D[2] ^ D[1] ^ D[0] ^ C[0] ^ C[1] ^ 
                 C[2] ^ C[6] ^ C[7] ^ C[8] ^ C[9] ^ C[13] ^ 
                 C[14] ^ C[16] ^ C[17] ^ C[18] ^ C[24] ^ C[26] ^ 
                 C[30] ^ C[31];
  
    CRC[3]    =  D[31] ^ D[27] ^ D[25] ^ D[19] ^ D[18] ^ D[17] ^ 
                 D[15] ^ D[14] ^ D[10] ^ D[9] ^ D[8] ^ D[7] ^ 
                 D[3] ^ D[2] ^ D[1] ^ C[1] ^ C[2] ^ C[3] ^ 
                 C[7] ^ C[8] ^ C[9] ^ C[10] ^ C[14] ^ C[15] ^ 
                 C[17] ^ C[18] ^ C[19] ^ C[25] ^ C[27] ^ C[31];
  
    CRC[4]    =  D[31] ^ D[30] ^ D[29] ^ D[25] ^ D[24] ^ D[20] ^ 
                 D[19] ^ D[18] ^ D[15] ^ D[12] ^ D[11] ^ D[8] ^ 
                 D[6] ^ D[4] ^ D[3] ^ D[2] ^ D[0] ^ C[0] ^ 
                 C[2] ^ C[3] ^ C[4] ^ C[6] ^ C[8] ^ C[11] ^ 
                 C[12] ^ C[15] ^ C[18] ^ C[19] ^ C[20] ^ C[24] ^ 
                 C[25] ^ C[29] ^ C[30] ^ C[31];
  
    CRC[5]    =  D[29] ^ D[28] ^ D[24] ^ D[21] ^ D[20] ^ D[19] ^ 
                 D[13] ^ D[10] ^ D[7] ^ D[6] ^ D[5] ^ D[4] ^ 
                 D[3] ^ D[1] ^ D[0] ^ C[0] ^ C[1] ^ C[3] ^ 
                 C[4] ^ C[5] ^ C[6] ^ C[7] ^ C[10] ^ C[13] ^ 
                 C[19] ^ C[20] ^ C[21] ^ C[24] ^ C[28] ^ C[29];
  
    CRC[6]    =  D[30] ^ D[29] ^ D[25] ^ D[22] ^ D[21] ^ D[20] ^ 
                 D[14] ^ D[11] ^ D[8] ^ D[7] ^ D[6] ^ D[5] ^ 
                 D[4] ^ D[2] ^ D[1] ^ C[1] ^ C[2] ^ C[4] ^ 
                 C[5] ^ C[6] ^ C[7] ^ C[8] ^ C[11] ^ C[14] ^ 
                 C[20] ^ C[21] ^ C[22] ^ C[25] ^ C[29] ^ C[30];
  
    CRC[7]    =  D[29] ^ D[28] ^ D[25] ^ D[24] ^ D[23] ^ D[22] ^ 
                 D[21] ^ D[16] ^ D[15] ^ D[10] ^ D[8] ^ D[7] ^ 
                 D[5] ^ D[3] ^ D[2] ^ D[0] ^ C[0] ^ C[2] ^ 
                 C[3] ^ C[5] ^ C[7] ^ C[8] ^ C[10] ^ C[15] ^ 
                 C[16] ^ C[21] ^ C[22] ^ C[23] ^ C[24] ^ C[25] ^ 
                 C[28] ^ C[29];
  
    CRC[8]    =  D[31] ^ D[28] ^ D[23] ^ D[22] ^ D[17] ^ D[12] ^ 
                 D[11] ^ D[10] ^ D[8] ^ D[4] ^ D[3] ^ D[1] ^ 
                 D[0] ^ C[0] ^ C[1] ^ C[3] ^ C[4] ^ C[8] ^ 
                 C[10] ^ C[11] ^ C[12] ^ C[17] ^ C[22] ^ C[23] ^ 
                 C[28] ^ C[31];
  
    CRC[9]    =  D[29] ^ D[24] ^ D[23] ^ D[18] ^ D[13] ^ D[12] ^ 
                 D[11] ^ D[9] ^ D[5] ^ D[4] ^ D[2] ^ D[1] ^ 
                 C[1] ^ C[2] ^ C[4] ^ C[5] ^ C[9] ^ C[11] ^ 
                 C[12] ^ C[13] ^ C[18] ^ C[23] ^ C[24] ^ C[29];
  
    CRC[10]   =   D[31] ^ D[29] ^ D[28] ^ D[26] ^ D[19] ^ D[16] ^ 
                  D[14] ^ D[13] ^ D[9] ^ D[5] ^ D[3] ^ D[2] ^ 
                  D[0] ^ C[0] ^ C[2] ^ C[3] ^ C[5] ^ C[9] ^ 
                  C[13] ^ C[14] ^ C[16] ^ C[19] ^ C[26] ^ C[28] ^ 
                  C[29] ^ C[31];
  
    CRC[11]   =   D[31] ^ D[28] ^ D[27] ^ D[26] ^ D[25] ^ D[24] ^ 
                  D[20] ^ D[17] ^ D[16] ^ D[15] ^ D[14] ^ D[12] ^ 
                  D[9] ^ D[4] ^ D[3] ^ D[1] ^ D[0] ^ C[0] ^ 
                  C[1] ^ C[3] ^ C[4] ^ C[9] ^ C[12] ^ C[14] ^ 
                  C[15] ^ C[16] ^ C[17] ^ C[20] ^ C[24] ^ C[25] ^ 
                  C[26] ^ C[27] ^ C[28] ^ C[31];
  
    CRC[12]   =   D[31] ^ D[30] ^ D[27] ^ D[24] ^ D[21] ^ D[18] ^ 
                  D[17] ^ D[15] ^ D[13] ^ D[12] ^ D[9] ^ D[6] ^ 
                  D[5] ^ D[4] ^ D[2] ^ D[1] ^ D[0] ^ C[0] ^ 
                  C[1] ^ C[2] ^ C[4] ^ C[5] ^ C[6] ^ C[9] ^ 
                  C[12] ^ C[13] ^ C[15] ^ C[17] ^ C[18] ^ C[21] ^ 
                  C[24] ^ C[27] ^ C[30] ^ C[31];
  
    CRC[13]   =   D[31] ^ D[28] ^ D[25] ^ D[22] ^ D[19] ^ D[18] ^ 
                  D[16] ^ D[14] ^ D[13] ^ D[10] ^ D[7] ^ D[6] ^ 
                  D[5] ^ D[3] ^ D[2] ^ D[1] ^ C[1] ^ C[2] ^ 
                  C[3] ^ C[5] ^ C[6] ^ C[7] ^ C[10] ^ C[13] ^ 
                  C[14] ^ C[16] ^ C[18] ^ C[19] ^ C[22] ^ C[25] ^ 
                  C[28] ^ C[31];
  
    CRC[14]   =   D[29] ^ D[26] ^ D[23] ^ D[20] ^ D[19] ^ D[17] ^ 
                  D[15] ^ D[14] ^ D[11] ^ D[8] ^ D[7] ^ D[6] ^ 
                  D[4] ^ D[3] ^ D[2] ^ C[2] ^ C[3] ^ C[4] ^ 
                  C[6] ^ C[7] ^ C[8] ^ C[11] ^ C[14] ^ C[15] ^ 
                  C[17] ^ C[19] ^ C[20] ^ C[23] ^ C[26] ^ C[29];
  
    CRC[15]   =   D[30] ^ D[27] ^ D[24] ^ D[21] ^ D[20] ^ D[18] ^ 
                  D[16] ^ D[15] ^ D[12] ^ D[9] ^ D[8] ^ D[7] ^ 
                  D[5] ^ D[4] ^ D[3] ^ C[3] ^ C[4] ^ C[5] ^ 
                  C[7] ^ C[8] ^ C[9] ^ C[12] ^ C[15] ^ C[16] ^ 
                  C[18] ^ C[20] ^ C[21] ^ C[24] ^ C[27] ^ C[30];
  
    CRC[16]   =   D[30] ^ D[29] ^ D[26] ^ D[24] ^ D[22] ^ D[21] ^ 
                  D[19] ^ D[17] ^ D[13] ^ D[12] ^ D[8] ^ D[5] ^ 
                  D[4] ^ D[0] ^ C[0] ^ C[4] ^ C[5] ^ C[8] ^ 
                  C[12] ^ C[13] ^ C[17] ^ C[19] ^ C[21] ^ C[22] ^ 
                  C[24] ^ C[26] ^ C[29] ^ C[30];
  
    CRC[17]   =   D[31] ^ D[30] ^ D[27] ^ D[25] ^ D[23] ^ D[22] ^ 
                  D[20] ^ D[18] ^ D[14] ^ D[13] ^ D[9] ^ D[6] ^ 
                  D[5] ^ D[1] ^ C[1] ^ C[5] ^ C[6] ^ C[9] ^ 
                  C[13] ^ C[14] ^ C[18] ^ C[20] ^ C[22] ^ C[23] ^ 
                  C[25] ^ C[27] ^ C[30] ^ C[31];
  
    CRC[18]   =   D[31] ^ D[28] ^ D[26] ^ D[24] ^ D[23] ^ D[21] ^ 
                  D[19] ^ D[15] ^ D[14] ^ D[10] ^ D[7] ^ D[6] ^ 
                  D[2] ^ C[2] ^ C[6] ^ C[7] ^ C[10] ^ C[14] ^ 
                  C[15] ^ C[19] ^ C[21] ^ C[23] ^ C[24] ^ C[26] ^ 
                  C[28] ^ C[31];
  
    CRC[19]   =   D[29] ^ D[27] ^ D[25] ^ D[24] ^ D[22] ^ D[20] ^ 
                  D[16] ^ D[15] ^ D[11] ^ D[8] ^ D[7] ^ D[3] ^ 
                  C[3] ^ C[7] ^ C[8] ^ C[11] ^ C[15] ^ C[16] ^ 
                  C[20] ^ C[22] ^ C[24] ^ C[25] ^ C[27] ^ C[29];
  
    CRC[20]   =   D[30] ^ D[28] ^ D[26] ^ D[25] ^ D[23] ^ D[21] ^ 
                  D[17] ^ D[16] ^ D[12] ^ D[9] ^ D[8] ^ D[4] ^ 
                  C[4] ^ C[8] ^ C[9] ^ C[12] ^ C[16] ^ C[17] ^ 
                  C[21] ^ C[23] ^ C[25] ^ C[26] ^ C[28] ^ C[30];
  
    CRC[21]   =   D[31] ^ D[29] ^ D[27] ^ D[26] ^ D[24] ^ D[22] ^ 
                  D[18] ^ D[17] ^ D[13] ^ D[10] ^ D[9] ^ D[5] ^ 
                  C[5] ^ C[9] ^ C[10] ^ C[13] ^ C[17] ^ C[18] ^ 
                  C[22] ^ C[24] ^ C[26] ^ C[27] ^ C[29] ^ C[31];
  
    CRC[22]   =   D[31] ^ D[29] ^ D[27] ^ D[26] ^ D[24] ^ D[23] ^ 
                  D[19] ^ D[18] ^ D[16] ^ D[14] ^ D[12] ^ D[11] ^ 
                  D[9] ^ D[0] ^ C[0] ^ C[9] ^ C[11] ^ C[12] ^ 
                  C[14] ^ C[16] ^ C[18] ^ C[19] ^ C[23] ^ C[24] ^ 
                  C[26] ^ C[27] ^ C[29] ^ C[31];
  
    CRC[23]   =   D[31] ^ D[29] ^ D[27] ^ D[26] ^ D[20] ^ D[19] ^ 
                  D[17] ^ D[16] ^ D[15] ^ D[13] ^ D[9] ^ D[6] ^ 
                  D[1] ^ D[0] ^ C[0] ^ C[1] ^ C[6] ^ C[9] ^ 
                  C[13] ^ C[15] ^ C[16] ^ C[17] ^ C[19] ^ C[20] ^ 
                  C[26] ^ C[27] ^ C[29] ^ C[31];
  
    CRC[24]   =   D[30] ^ D[28] ^ D[27] ^ D[21] ^ D[20] ^ D[18] ^ 
                  D[17] ^ D[16] ^ D[14] ^ D[10] ^ D[7] ^ D[2] ^ 
                  D[1] ^ C[1] ^ C[2] ^ C[7] ^ C[10] ^ C[14] ^ 
                  C[16] ^ C[17] ^ C[18] ^ C[20] ^ C[21] ^ C[27] ^ 
                  C[28] ^ C[30];
  
    CRC[25]   =   D[31] ^ D[29] ^ D[28] ^ D[22] ^ D[21] ^ D[19] ^ 
                  D[18] ^ D[17] ^ D[15] ^ D[11] ^ D[8] ^ D[3] ^ 
                  D[2] ^ C[2] ^ C[3] ^ C[8] ^ C[11] ^ C[15] ^ 
                  C[17] ^ C[18] ^ C[19] ^ C[21] ^ C[22] ^ C[28] ^ 
                  C[29] ^ C[31];
  
    CRC[26]   =   D[31] ^ D[28] ^ D[26] ^ D[25] ^ D[24] ^ D[23] ^ 
                  D[22] ^ D[20] ^ D[19] ^ D[18] ^ D[10] ^ D[6] ^ 
                  D[4] ^ D[3] ^ D[0] ^ C[0] ^ C[3] ^ C[4] ^ 
                  C[6] ^ C[10] ^ C[18] ^ C[19] ^ C[20] ^ C[22] ^ 
                  C[23] ^ C[24] ^ C[25] ^ C[26] ^ C[28] ^ C[31];
  
    CRC[27]   =   D[29] ^ D[27] ^ D[26] ^ D[25] ^ D[24] ^ D[23] ^ 
                  D[21] ^ D[20] ^ D[19] ^ D[11] ^ D[7] ^ D[5] ^ 
                  D[4] ^ D[1] ^ C[1] ^ C[4] ^ C[5] ^ C[7] ^ 
                  C[11] ^ C[19] ^ C[20] ^ C[21] ^ C[23] ^ C[24] ^ 
                  C[25] ^ C[26] ^ C[27] ^ C[29];
  
    CRC[28]   =   D[30] ^ D[28] ^ D[27] ^ D[26] ^ D[25] ^ D[24] ^ 
                  D[22] ^ D[21] ^ D[20] ^ D[12] ^ D[8] ^ D[6] ^ 
                  D[5] ^ D[2] ^ C[2] ^ C[5] ^ C[6] ^ C[8] ^ 
                  C[12] ^ C[20] ^ C[21] ^ C[22] ^ C[24] ^ C[25] ^ 
                  C[26] ^ C[27] ^ C[28] ^ C[30];
  
    CRC[29]   =   D[31] ^ D[29] ^ D[28] ^ D[27] ^ D[26] ^ D[25] ^ 
                  D[23] ^ D[22] ^ D[21] ^ D[13] ^ D[9] ^ D[7] ^ 
                  D[6] ^ D[3] ^ C[3] ^ C[6] ^ C[7] ^ C[9] ^ 
                  C[13] ^ C[21] ^ C[22] ^ C[23] ^ C[25] ^ C[26] ^ 
                  C[27] ^ C[28] ^ C[29] ^ C[31];
  
    CRC[30]   =   D[30] ^ D[29] ^ D[28] ^ D[27] ^ D[26] ^ D[24] ^ 
                  D[23] ^ D[22] ^ D[14] ^ D[10] ^ D[8] ^ D[7] ^ 
                  D[4] ^ C[4] ^ C[7] ^ C[8] ^ C[10] ^ C[14] ^ 
                  C[22] ^ C[23] ^ C[24] ^ C[26] ^ C[27] ^ C[28] ^ 
                  C[29] ^ C[30];
  
    CRC[31]   =   D[31] ^ D[30] ^ D[29] ^ D[28] ^ D[27] ^ D[25] ^ 
                  D[24] ^ D[23] ^ D[15] ^ D[11] ^ D[9] ^ D[8] ^ 
                  D[5] ^ C[5] ^ C[8] ^ C[9] ^ C[11] ^ C[15] ^ 
                  C[23] ^ C[24] ^ C[25] ^ C[27] ^ C[28] ^ C[29] ^ 
                  C[30] ^ C[31];     
//////////////////////////////////////////////////////////////////////////     

for(i=0; i<8;i++){

    hexa[i] = ((CRC[31 - i*4]*1000)+(CRC[30 - i*4]*100)+(CRC[29 - i*4]*10)+(CRC[28 - i*4]));
    
    //printf("valor e: %d\n", hexa[i]);


switch(hexa[i]){
         
         case 0 : fin_hex[i]= '0';
              break;
              
         case 1 : fin_hex[i] = '1';
              break;    

         case 10 : fin_hex[i] = '2';
              break;
              
         case 11 : fin_hex[i] = '3';
              break;
              
         case 100 : fin_hex[i] = '4';
              break;
              
         case 101 : fin_hex[i] = '5';
              break;
              
         case 110 : fin_hex[i] = '6';
              break;
              
         case 111 : fin_hex[i] = '7';
              break;
              
         case 1000 : fin_hex[i] = '8';
              break;
              
         case 1001 : fin_hex[i] = '9';
              break;
              
         case 1010 : fin_hex[i] = 'A';
              break;
            
         case 1011 : fin_hex[i] = 'B';
              break;
            
         case 1100 : fin_hex[i] = 'C';
              break;
      
         case 1101 : fin_hex[i] = 'D';
              break;
 
         case 1110 : fin_hex[i] = 'E';
              break;
              
         case 1111 : fin_hex[i] = 'F';
              break;

    }

}
fin_hex[8] = '\0';

printf("\nCRC HEXA: %s\n", fin_hex);

//printf("O CRC Calculado e: ");
for(i=0; i<32; i++){
         
   //printf("%d",CRC[31-i]);

}
//printf("\n\n");




}

        
int main(){
    
    char input[9];
    int x,int_bin[8],i,g,e;

    x=1;
    
    for(i=0;i<32;i++){
    
       C[i] = 0;
       
    }
    
	while(x == 1) {
		
    	g=0;
    	e=1;
    	//memset[input,'\0',9];           
    	while(e==1) {
			
        	printf("\nDigite o dado em hexadecimal: ");
        	scanf("%s", &input);

			//Pega valor invertido i=0 é o mais significativo
    
        	for (i=0; i<strlen(input); i++) {
            	//printf[ " char : %c int: %d \n", input[i], input[i]];
            
            	if (((input[i] > 47 && input[i] <58) || (input[i] > 96 && input[i] <103) || (input[i] > 64 && input[i] <71))) {
               		g++;
            	}
                       
	        }
        	
        	if(g != 8){
             
            	printf(" A entrada esta incorreta! Tente de novo\n");
            	e=1;
            	g=0;
        	}
        	else
            	e=0;
    	}
    
    	// input: HHhhHHhh
    	
    	//printf("A palavra e: %s \n", input);
    	
    	// int int_bin[8]
    	// int CRC[32], Inic[32],D[32],C[32];
    	for (i=0; i<8; i++)	{
        
        	int_bin[i] = hexatobin(input[i]);
        	D[31-(i*4)] = int_bin[i]/1000;
        	D[30-(i*4)] = (int_bin[i]/100)%10;
        	D[29-(i*4)] = (int_bin[i]/10)%10;
        	D[28-(i*4)] = (int_bin[i]%10);
        
        	//printf( "inteiro de %c = %d posicao: %d%d%d%d  em binario = %d%d%d%d\n", input[i], int_bin[i],(31-(i*4)),(30-(i*4)),(29-(i*4)),(28-(i*4)), D[31-(i*4)],D[30-(i*4)],D[29-(i*4)],D[28-(i*4)]);
            
    	}
    
    
    	CalcCRC();

    
    
    	printf("\nMais dados de entrada? \n1-Sim\n2-Nao\n");
    	scanf("%d",&x);
    
    	if( x == 1 )	{
      		for(i=0;i<32;i++){
    
        	C[i] = CRC[i];
       
      	}
    }
    
    else{
    
        printf("\nCalcular novo CRC? \n1- Sim\n2- Nao\n");
        scanf("%d",&x);
        if(x==1){
        
            for(i=0;i<32;i++){
    
               C[i] = 0;
       
            }
        }
    }    

}    
    //system("PAUSE");
    return 0;
}
